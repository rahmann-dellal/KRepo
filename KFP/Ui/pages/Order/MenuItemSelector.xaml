<?xml version="1.0" encoding="utf-8"?>
<UserControl  
   x:Class="KFP.Ui.pages.MenuItemSelector"  
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"  
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"  
   xmlns:local="using:KFP.Ui.pages"  
   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"  
   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"  
   xmlns:controls="using:CommunityToolkit.WinUI.Controls"  
   xmlns:models="using:KFP.DATA"  
   xmlns:vm="using:KFP.ViewModels"  
   xmlns:converters="using:KFP.Converters"  
   mc:Ignorable="d"  
   DataContext="{x:Bind ViewModel}"  
   x:Name="selector">  

   <UserControl.Resources>  
       <converters:BoolToBrushConverter x:Key="boolToBrushConverter" />
        <converters:MenuItemTypeConverter x:Key="menuItemTypeConverter" />
    </UserControl.Resources>  

   <Grid>  
       <Grid.RowDefinitions>  
           <RowDefinition Height="auto"/>  
           <RowDefinition Height="*"/>  
       </Grid.RowDefinitions>  
       <!-- Filters -->

        <StackPanel Orientation="Vertical" Margin="0,10,30,0" Grid.Row="0" >

            <TextBlock Text="Category" FontSize="13" Margin="0,0,0,10" HorizontalAlignment="Center" FontWeight="Bold"/>
            <ListView MaxHeight="130" SelectionMode="Multiple"
                     ItemsSource="{x:Bind ViewModel.Categories}" SelectionChanged="ListView_SelectionChanged">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <controls:WrapPanel HorizontalAlignment="Center" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Category">
                        <Border>
                            <TextBlock Text="{x:Bind Path=CategoryName }" />
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            <TextBlock Text="Type" Margin="0,10,0,0" HorizontalAlignment="Center" FontWeight="Bold" FontSize="13"/>
            <SelectorBar x:Name="TypeSelectorBar" Margin="0,0,0,0" HorizontalAlignment="Center" SelectionChanged="TypeSelectorBar_SelectionChanged">
                <SelectorBarItem x:Name="all" Text="All"/>
                <SelectorBarItem x:Name="Main" Text="Main"/>
                <SelectorBarItem x:Name="AddOns" Text="Add-ons"/>
                <SelectorBarItem x:Name="Drink" Text="Drinks"/>
                <SelectorBarItem x:Name="Other" Text="Other"/>
            </SelectorBar>
        </StackPanel>  

       <!-- Menu Items List -->  
       <Border Grid.Row="1" Margin="0,2,30,20" BorderBrush="{ThemeResource SystemAccentColor}" BorderThickness="0" CornerRadius="2" Background="#FFF4F4F4">  
           <ListView ItemsSource="{Binding FilteredMenuItems}"   
                 Margin="0,10,0,10"  
                 SelectedItem="{Binding SelectedMenuItem, Mode=TwoWay}" SelectionMode="None">  
               <ItemsControl.ItemsPanel>  
                   <ItemsPanelTemplate>  
                       <controls:WrapPanel HorizontalAlignment="Center" />  
                   </ItemsPanelTemplate>  
               </ItemsControl.ItemsPanel>  
               <ListView.ItemTemplate>  
                   <DataTemplate x:DataType="vm:MenuItemElement">  
                       <Button Command="{Binding Path=ViewModel.SelectMenuItemCommand, ElementName=selector}" CommandParameter="{Binding}" Click="Button_Click">  
                           <Button.Template>  
                               <ControlTemplate TargetType="Button">  
                                   <Border Margin="5" Padding="5" Background="{StaticResource CardBackgroundFillColorDefaultBrush}"  
                                           BorderBrush="{Binding IsSelected, Converter={StaticResource boolToBrushConverter}}"  
                                           BorderThickness="{Binding IsSelected, Converter={StaticResource boolToBrushConverter}, ConverterParameter='1'}" CornerRadius="2" Width="200">  
                                       <Grid>  
                                           <Grid.ColumnDefinitions>  
                                               <ColumnDefinition Width="auto" />  
                                               <ColumnDefinition Width="*" />  
                                           </Grid.ColumnDefinitions>  
                                           <Border CornerRadius="4" Grid.Column="0" BorderThickness="2" BorderBrush="LightGray" Width="60" Height="60">  
                                               <Image Source="{Binding ThumbnailUri}" Width="60" Height="60" Stretch="Fill" />  
                                           </Border>  
                                           <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Top" Grid.Column="1" Margin="20,5,0,0">  
                                               <TextBlock Text="{Binding MenuItem.ItemName}" FontSize="18" Margin="0,0,0,10" FontWeight="Bold" HorizontalAlignment="Center"  
                                              TextWrapping="Wrap" TextTrimming="WordEllipsis"  LineStackingStrategy="BlockLineHeight" LineHeight="20"  
                                               MaxHeight="50"/>  
                                               <TextBlock  HorizontalAlignment="Center">  
                                                   <Run Text="{Binding MenuItem.SalePrice}" />  
                                                   <Run Text="{Binding Currency}" />  
                                               </TextBlock>  
                                           </StackPanel>  
                                       </Grid>  
                                   </Border>  
                               </ControlTemplate>  
                           </Button.Template>  
                       </Button>  
                   </DataTemplate>  
               </ListView.ItemTemplate>  
           </ListView>  
       </Border>  
   </Grid>  
</UserControl>
